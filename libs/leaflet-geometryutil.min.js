!function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)e=require("leaflet"),module.exports=t(e);else{if(void 0===window.L)throw"Leaflet must be loaded first";t(window.L)}}(function(t){return t.Polyline._flat=t.LineUtil.isFlat||t.Polyline._flat||function(e){return!t.Util.isArray(e[0])||"object"!=typeof e[0][0]&&void 0!==e[0][0]},t.GeometryUtil=t.extend(t.GeometryUtil||{},{distance:function(t,e,n){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(n))},distanceSegment:function(e,n,r,o){var i=e.latLngToLayerPoint(n),a=e.latLngToLayerPoint(r),l=e.latLngToLayerPoint(o);return t.LineUtil.pointToSegmentDistance(i,a,l)},readableDistance:function(t,e){var n;return"imperial"!==e?n=t>1e3?(t/1e3).toFixed(2)+" km":t.toFixed(1)+" m":(t*=1.09361,n=t>1760?(t/1760).toFixed(2)+" miles":t.toFixed(1)+" yd"),n},belongsSegment:function(t,e,n,r){r=void 0===r?.2:r;var o=e.distanceTo(n);return(e.distanceTo(t)+t.distanceTo(n)-o)/o<r},length:function(e){var n=t.GeometryUtil.accumulatedLengths(e);return n.length>0?n[n.length-1]:0},accumulatedLengths:function(t){if("function"==typeof t.getLatLngs&&(t=t.getLatLngs()),0===t.length)return[];for(var e=0,n=[0],r=0,o=t.length-1;r<o;r++)n.push(e+=t[r].distanceTo(t[r+1]));return n},closestOnSegment:function(e,n,r,o){var i=e.getMaxZoom();i===1/0&&(i=e.getZoom());var a=e.project(n,i),l=e.project(r,i),s=e.project(o,i),c=t.LineUtil.closestPointOnSegment(a,l,s);return e.unproject(c,i)},closest:function(e,n,r,o){var i,a,l,s,c,u=1/0,g=null;if(n instanceof Array){if(n[0]instanceof Array&&"number"!=typeof n[0][0]){for(a=0;a<n.length;a++)(c=t.GeometryUtil.closest(e,n[a],r,o))&&c.distance<u&&(u=c.distance,g=c);return g}if(!(n[0]instanceof t.LatLng)&&"number"!=typeof n[0][0]&&"number"!=typeof n[0].lat)return g;n=t.polyline(n)}if(!(n instanceof t.Polyline))return g;if(i=JSON.parse(JSON.stringify(n.getLatLngs().slice(0))),n instanceof t.Polygon){var f=function(e){if(t.Polyline._flat(e))e.push(e[0]);else for(var n=0;n<e.length;n++)f(e[n])};f(i)}if(t.Polyline._flat(i)){if(o){for(a=0,l=i.length;a<l;a++){var $=i[a];(s=t.GeometryUtil.distance(e,r,$))<u&&(u=s,(g=$).distance=s)}return g}for(a=0,l=i.length;a<l-1;a++){var y=i[a],L=i[a+1];(s=t.GeometryUtil.distanceSegment(e,r,y,L))<=u&&(u=s,(g=t.GeometryUtil.closestOnSegment(e,r,y,L)).distance=s)}return g}for(a=0;a<i.length;a++)(c=t.GeometryUtil.closest(e,i[a],r,o)).distance<u&&(u=c.distance,g=c);return g},closestLayer:function(e,n,r){for(var o=1/0,i=null,a=null,l=1/0,s=0,c=n.length;s<c;s++){var u=n[s];if(u instanceof t.LayerGroup){var g=t.GeometryUtil.closestLayer(e,u.getLayers(),r);g.distance<o&&(o=g.distance,i=g)}else"function"==typeof u.getLatLng?(a=u.getLatLng(),l=t.GeometryUtil.distance(e,r,a)):(a=t.GeometryUtil.closest(e,u,r))&&(l=a.distance),l<o&&(o=l,i={layer:u,latlng:a,distance:l})}return i},nClosestLayers:function(e,n,r,o){if((o="number"==typeof o?o:n.length)<1||n.length<1)return null;for(var i,a,l=[],s=0,c=n.length;s<c;s++){var u=n[s];if(u instanceof t.LayerGroup){var g=t.GeometryUtil.closestLayer(e,u.getLayers(),r);l.push(g)}else"function"==typeof u.getLatLng?(a=u.getLatLng(),i=t.GeometryUtil.distance(e,r,a)):(a=t.GeometryUtil.closest(e,u,r))&&(i=a.distance),l.push({layer:u,latlng:a,distance:i})}return(l.sort(function(t,e){return t.distance-e.distance}),l.length>o)?l.slice(0,o):l},layersWithin:function(e,n,r,o){o="number"==typeof o?o:1/0;for(var i=[],a=null,l=0,s=0,c=n.length;s<c;s++){var u=n[s];"function"==typeof u.getLatLng?(a=u.getLatLng(),l=t.GeometryUtil.distance(e,r,a)):(a=t.GeometryUtil.closest(e,u,r))&&(l=a.distance),a&&l<o&&i.push({layer:u,latlng:a,distance:l})}return i.sort(function(t,e){return t.distance-e.distance})},closestLayerSnap:function(e,n,r,o,i){o="number"==typeof o?o:1/0,i="boolean"!=typeof i||i;var a=t.GeometryUtil.closestLayer(e,n,r);if(!a||a.distance>o)return null;if(i&&"function"==typeof a.layer.getLatLngs){var l=t.GeometryUtil.closest(e,a.layer,a.latlng,!0);l.distance<o&&(a.latlng=l,a.distance=t.GeometryUtil.distance(e,l,r))}return a},interpolateOnPointSegment:function(e,n,r){return t.point(e.x*(1-r)+r*n.x,e.y*(1-r)+r*n.y)},interpolateOnLine:function(e,n,r){var o=(n=n instanceof t.Polyline?n.getLatLngs():n).length;if(o<2)return null;if(0===(r=Math.max(Math.min(r,1),0)))return{latLng:n[0]instanceof t.LatLng?n[0]:t.latLng(n[0]),predecessor:-1};if(1==r)return{latLng:n[n.length-1]instanceof t.LatLng?n[n.length-1]:t.latLng(n[n.length-1]),predecessor:n.length-2};var i=e.getMaxZoom();i===1/0&&(i=e.getZoom());for(var a=[],l=0,s=0;s<o;s++)a[s]=e.project(n[s],i),s>0&&(l+=a[s-1].distanceTo(a[s]));for(var c=l*r,u=0,g=0,s=0;g<c;s++){var f=a[s],$=a[s+1];u=g,g+=f.distanceTo($)}if(void 0==f&&void 0==$)var f=a[0],$=a[1],s=1;var y=g-u!=0?(c-u)/(g-u):0,L=t.GeometryUtil.interpolateOnPointSegment(f,$,y);return{latLng:e.unproject(L,i),predecessor:s-1}},locateOnLine:function(e,n,r){var o=n.getLatLngs();if(r.equals(o[0]))return 0;if(r.equals(o[o.length-1]))return 1;for(var i=t.GeometryUtil.closest(e,n,r,!1),a=t.GeometryUtil.accumulatedLengths(o),l=a[a.length-1],s=0,c=!1,u=0,g=o.length-1;u<g;u++){var f=o[u],$=o[u+1];if(s=a[u],t.GeometryUtil.belongsSegment(i,f,$,.001)){s+=f.distanceTo(i),c=!0;break}}if(!c)throw"Could not interpolate "+r.toString()+" within "+n.toString();return s/l},reverse:function(e){return t.polyline(e.getLatLngs().slice(0).reverse())},extract:function(e,n,r,o){if(r>o)return t.GeometryUtil.extract(e,t.GeometryUtil.reverse(n),1-r,1-o);r=Math.max(Math.min(r,1),0),o=Math.max(Math.min(o,1),0);var i=n.getLatLngs(),a=t.GeometryUtil.interpolateOnLine(e,n,r),l=t.GeometryUtil.interpolateOnLine(e,n,o);if(r==o)return[t.GeometryUtil.interpolateOnLine(e,n,o).latLng];-1==a.predecessor&&(a.predecessor=0),-1==l.predecessor&&(l.predecessor=0);var s=i.slice(a.predecessor+1,l.predecessor+1);return s.unshift(a.latLng),s.push(l.latLng),s},isBefore:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs();return n[n.length-1].equals(r[0])},isAfter:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs();return n[0].equals(r[r.length-1])},startsAtExtremity:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs(),o=n[0];return o.equals(r[0])||o.equals(r[r.length-1])},computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},computeSlope:function(t,e){var n=(e.y-t.y)/(e.x-t.x),r=t.y-n*t.x;return{a:n,b:r}},rotatePoint:function(e,n,r,o){var i=e.getMaxZoom();i===1/0&&(i=e.getZoom());var a=r*Math.PI/180,l=e.project(n,i),s=e.project(o,i),c=Math.cos(a)*(l.x-s.x)-Math.sin(a)*(l.y-s.y)+s.x,u=Math.sin(a)*(l.x-s.x)+Math.cos(a)*(l.y-s.y)+s.y;return e.unproject(new t.Point(c,u),i)},bearing:function(t,e){var n=Math.PI/180,r=t.lat*n,o=e.lat*n,i=t.lng*n,a=e.lng*n,l=(180*Math.atan2(Math.sin(a-i)*Math.cos(o),Math.cos(r)*Math.sin(o)-Math.sin(r)*Math.cos(o)*Math.cos(a-i))/Math.PI+360)%360;return l>=180?l-360:l},destination:function(e,n,r){n=(n+360)%360;var o=Math.PI/180,i=180/Math.PI,a=e.lng*o,l=e.lat*o,s=n*o,c=Math.sin(l),u=Math.cos(l),g=Math.cos(r/6378137),f=Math.sin(r/6378137),$=Math.asin(c*g+u*f*Math.cos(s)),y=a+Math.atan2(Math.sin(s)*f*u,g-c*Math.sin($));return y*=i,y=y>180?y-360:y<-180?y+360:y,t.latLng([$*i,y])},angle:function(t,e,n){var r=t.latLngToContainerPoint(e),o=t.latLngToContainerPoint(n),i=180*Math.atan2(o.y-r.y,o.x-r.x)/Math.PI+90;return i+(i<0?360:0)},destinationOnSegment:function(e,n,r,o){var i=t.GeometryUtil.angle(e,n,r),a=t.GeometryUtil.destination(n,i,o);return t.GeometryUtil.closestOnSegment(e,a,n,r)}}),t.GeometryUtil});